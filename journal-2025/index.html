<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Journal 2025</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="icon" type="image/x-icon" href="/green.png">
  <!-- <script type="text/javascript" src="/livejs.com/live.js" async></script> -->
  <link rel="stylesheet" href="/adjustments.css">

  <script type="text/javascript">
    const hostCanonical = "play.teod.eu";
    const hostAlias1 = "playground.teod.eu";
    const hostLocal1 = "localhost:9945";
    if (
      window.location.host === hostAlias1
      // || window.location.host === hostLocal1
    ) {
      // redirect playground.teod.eu to play.teod.eu
      // redirect playground.teod.eu/aphorisms to play.teod.eu/aphorisms
      const pathname = window.location.pathname || "";
      window.location.replace("https://" + hostCanonical + pathname);
    }
  </script>

  <script async type="module" src="/index/big.js"></script>
  <script async type="module" src="/iki/iki.js"></script>
  <script async type="module">
    import {IkiGotoRandomPage} from "/iki/iki.js";

    customElements.define("iki-goto-random-page", IkiGotoRandomPage, {extends: "button"});
  </script>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Journal 2025</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#section" id="toc-section">2025-01-18</a>
<ul>
<li><a href="#memex-assistert-kunnskapsarbeid-for-å-bygge-gode-teorier"
id="toc-memex-assistert-kunnskapsarbeid-for-å-bygge-gode-teorier">Memex-assistert
kunnskapsarbeid for å bygge gode teorier</a></li>
</ul></li>
<li><a href="#section-1" id="toc-section-1">2025-03-02</a>
<ul>
<li><a href="#om-å-snakke-presist-om-abstrakte-konsepter"
id="toc-om-å-snakke-presist-om-abstrakte-konsepter">Om å snakke presist
om abstrakte konsepter</a></li>
<li><a
href="#la-oss-ikke-drive-med-conveyance-for-imformasjon-vi-ikke-trenger-å-sende-rundt"
id="toc-la-oss-ikke-drive-med-conveyance-for-imformasjon-vi-ikke-trenger-å-sende-rundt">La
oss ikke drive med conveyance for imformasjon vi ikke trenger å sende
rundt</a></li>
</ul></li>
<li><a href="#section-2" id="toc-section-2">2025-04-29</a>
<ul>
<li><a
href="#three-modes-of-creation-goal-consistent-flow-driven-and-wip-reduction"
id="toc-three-modes-of-creation-goal-consistent-flow-driven-and-wip-reduction">Three
modes of creation: goal consistent, flow driven and WIP
reduction</a></li>
<li><a
href="#embracing-human-computer-interaction-how-my-programming-style-has-changed"
id="toc-embracing-human-computer-interaction-how-my-programming-style-has-changed">Embracing
human-computer interaction: how my programming style has
changed</a></li>
</ul></li>
</ul>
</nav>
<p><a href="..">..</a></p>
<h2 id="section">2025-01-18</h2>
<h3
id="memex-assistert-kunnskapsarbeid-for-å-bygge-gode-teorier">Memex-assistert
kunnskapsarbeid for å bygge gode teorier</h3>
<p>Terminologi:</p>
<ul>
<li>Memex</li>
<li>Kunnskapsarbeid</li>
<li>Teori</li>
<li>God teori</li>
</ul>
<h2 id="section-1">2025-03-02</h2>
<h3 id="om-å-snakke-presist-om-abstrakte-konsepter">Om å snakke presist
om abstrakte konsepter</h3>
<p>Å være presis er ikke det samme som å være spesifikk.</p>
<p>Upresis benevning er vag. Uspesifikke utsagn snakker ikke om
spesifikke hendelser.</p>
<p>Å være spesifikk er lurt noen ganger, og dumt andre ganger. I en
feilrapport er det lurt å ta med spesifikk informasjon om hva som har
skjedd.</p>
<p>Når vi lager abstraksjoner, er vi ute etter presisjon, ikke detaljer.
Å lage abstraksjoner er i sin natur en øvelse om å ta et steg opp over
alle detaljene. Hvis vi tvinger oss selv til å kun snakke om detaljene,
kommer vi oss aldri opp.</p>
<h3
id="la-oss-ikke-drive-med-conveyance-for-imformasjon-vi-ikke-trenger-å-sende-rundt">La
oss ikke drive med conveyance for imformasjon vi ikke trenger å sende
rundt</h3>
<p>I Matnyttig-koden</p>
<h2 id="section-2">2025-04-29</h2>
<h3
id="three-modes-of-creation-goal-consistent-flow-driven-and-wip-reduction">Three
modes of creation: goal consistent, flow driven and WIP reduction</h3>
<p>The strategic decisions should be <strong>goal consistent</strong>.
If you wanna go somewhere, you need to make sure that target is
reachable. And it won’t be unless you make sure it is.</p>
<p>When <strong>driven by flow</strong>, you build speed and turn where
you can go the fastest. Intuition takes the front seat, analysis can
wait. See how fast you can go.</p>
<p><strong>Reducing WIP</strong> is the maintenance you need to enable
spurts of wild charge. Clean it up. Make it consistent.</p>
<h3
id="embracing-human-computer-interaction-how-my-programming-style-has-changed">Embracing
human-computer interaction: how my programming style has changed</h3>
<p>Looking back on how I first approached programming, I can’t help but
laugh. It was my first year of university, and we had two math courses
and a programming course. I did exercises in all three courses the same
way:</p>
<ol>
<li>Write down the problem</li>
<li>Think</li>
<li>Write down the solution, and check it step by step.</li>
</ol>
<p>My first two mandatory programming exercises went smoothly. Write the
code, check it, hand it in.</p>
<p>On the third, I got stuck, and asked a teaching assistant. His first
question left me flabbergasted. “What happens when you run your code?” I
thought that was a very stupid question to ask. “There’s no use in
running it. It’s not done! I have to write the rest first.”</p>
<p>Luckily, he persisted, and I <em>did</em> run the code as I’d written
it. We were using MATLAB, and after I’d run my code I could look at the
values of my variables. That was kind of useful!</p>
<hr />
<p>Programming <em>can</em> be viewed as working with formulas.</p>
<ol>
<li>First, translate the formula to computer language</li>
<li>Next, check the formula</li>
<li>Finally, execute the formula.</li>
</ol>
<p>Modern programming languages have gotten better at checking the
formulas with static analysis.</p>
<p>A different view of programming is that programming is two parallel
tasks:</p>
<ol>
<li>To solve a problem</li>
<li>… and to simultaneously build system that lets you interact with the
problem and the solution.</li>
</ol>
<p>I enjoy this style of interactive programming much more than the
formula-oriented one. It feels more <em>alive</em>.</p>
<p>I recently spent some time exploring <a
href="https://nats.io/">NATS</a>’ wire protocol. But where should I
start? I choose to start in a way that would let me interact. The
official <a
href="https://docs.nats.io/reference/reference-protocols/nats-protocol-demo">protocol
demo</a> was absolutely great for this!</p>
<p>First, connect to the demo server with <code
class="verbatim">telnet</code>.</p>
<pre><code>telnet demo.nats.io 4222
</code></pre>
<p>You should see the server identifying itself with an <code
class="verbatim">INFO</code> message:</p>
<pre class="text"><code>Trying 107.170.221.32...
Connected to demo.nats.io.
Escape character is &#39;^]&#39;.
INFO {&quot;server_id&quot;:&quot;NCXMJZYQEWUDJFLYLSTTE745I2WUNCVG3LJJ3NRKSFJXEG6RGK7753DJ&quot;,&quot;version&quot;:&quot;2.0.0&quot;,&quot;proto&quot;:1,&quot;go&quot;:&quot;go1.11.10&quot;,&quot;host&quot;:&quot;0.0.0.0&quot;,&quot;port&quot;:4222,&quot;max_payload&quot;:1048576,&quot;client_id&quot;:5089}
</code></pre>
<p>Then, send <code class="verbatim">CONNECT {}</code>:</p>
<pre class="text"><code>CONNECT {}
</code></pre>
<p>You should get an OK message back:</p>
<pre class="text"><code>+OK
</code></pre>
<p>Finally, when the server wants to know if you’re still there (<code
class="verbatim">PING</code>), answer (<code
class="verbatim">PONG</code>):</p>
<pre class="text"><code>PING
PONG
</code></pre>
<p>That’s it! That’s all!</p>
<p>I then wanted to translate what I’d learned into Clojure code using
java sockets. Starting small, let’s try to connect:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">import</span> &#39;(java.net Socket))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [socket (Socket. <span class="st">&quot;demo.nats.io&quot;</span> <span class="dv">4222</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      cleanup #(.close socket)]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">try</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">:lol</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">finally</span> (cleanup))))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">;; =&gt; :lol</span></span></code></pre></div>
<p>Nice!</p>
<p>I aim to take very small steps, and make sure I can run an expression
to see if my assumptions still hold.</p>
<p>Next, I want to get the <code class="verbatim">INFO</code>
message.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">import</span> &#39;(java.io InputStreamReader BufferedReader)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>        &#39;(java.net Socket))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [socket (Socket. <span class="st">&quot;demo.nats.io&quot;</span> <span class="dv">4222</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      reader (BufferedReader. (InputStreamReader. (.getInputStream socket)))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      cleanup #(<span class="kw">do</span> (.close reader)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                   (.close socket))]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">try</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    (.readLine reader)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">finally</span> (cleanup))))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">;; =&gt; &quot;INFO {\&quot;server_id\&quot;:\&quot;NDIESIZS7MWBAOM2BVC3YLEGJLGFMZYVO23OIYB7WUF5736JWKND5TKQ\&quot;,\&quot;server_name\&quot;:\&quot;us-south-nats-demo\&quot;,\&quot;version\&quot;:\&quot;2.11.2\&quot;,\&quot;proto\&quot;:1,\&quot;git_commit\&quot;:\&quot;55efd1d\&quot;,\&quot;go\&quot;:\&quot;go1.24.2\&quot;,\&quot;host\&quot;:\&quot;0.0.0.0\&quot;,\&quot;port\&quot;:4222,\&quot;headers\&quot;:true,\&quot;tls_available\&quot;:true,\&quot;max_payload\&quot;:1048576,\&quot;jetstream\&quot;:true,\&quot;client_id\&quot;:7640,\&quot;client_ip\&quot;:\&quot;89.8.1.56\&quot;,\&quot;nonce\&quot;:\&quot;QmdtypKmZykViYY\&quot;,\&quot;xkey\&quot;:\&quot;XCGB5DG4FLF6EA566VUEPSSHY4GLNKHEX4VYQD3SLZRZU4KUHWSQ2PHH\&quot;} &quot;</span></span></code></pre></div>
<p>Yay! Finding the right classes and methods from <code
class="verbatim">java.io</code> og <code
class="verbatim">java.net</code> took a bit of time, but taking
super-small steps kept me grounded and focused. “Many More Much Smaller
Steps”, <a
href="https://www.geepawhill.org/series/many-more-much-smaller-steps/">says
GeePaw Hill</a>. Smaller steps give smaller errors, and we can correct
our course quickly.</p>
<p>Now, let’s send the <code class="verbatim">CONNECT {}</code> and see
if we can get an <code class="verbatim">+OK</code> back.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">import</span> &#39;(java.io DataOutputStream InputStreamReader BufferedReader)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>        &#39;(java.net Socket))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [socket (Socket. <span class="st">&quot;demo.nats.io&quot;</span> <span class="dv">4222</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      reader (BufferedReader. (InputStreamReader. (.getInputStream socket)))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      writer (DataOutputStream. (.getOutputStream socket))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      cleanup #(<span class="kw">do</span> (.close reader)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                   (.close socket))]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">try</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">assert</span> (str/starts-with? (.readLine reader) <span class="st">&quot;INFO&quot;</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Expect INFO message from NATS server&quot;</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    (.writeBytes writer <span class="st">&quot;CONNECT {}</span><span class="sc">\r\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    (.<span class="kw">flush</span> writer)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    (.readLine reader)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">finally</span> (cleanup))))</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">;; =&gt; &quot;+OK&quot;</span></span></code></pre></div>
<p>What we expect! I add asserts to force early errors if I break code I
got working earlier.</p>
<p>Now, time for the <code class="verbatim">PING</code> and <code
class="verbatim">PONG</code>. These involve waiting, so they are a bit
tricky. First, I want to see if I can get any <code
class="verbatim">PING</code> whatsoever out of my system.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">import</span> &#39;(java.io DataOutputStream InputStreamReader BufferedReader)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>        &#39;(java.net Socket))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [socket (Socket. <span class="st">&quot;demo.nats.io&quot;</span> <span class="dv">4222</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>      reader (BufferedReader. (InputStreamReader. (.getInputStream socket)))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      writer (DataOutputStream. (.getOutputStream socket))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      cleanup #(<span class="kw">do</span> (.close reader)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                   (.close socket))]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">try</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">assert</span> (str/starts-with? (.readLine reader) <span class="st">&quot;INFO&quot;</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Expect INFO message from NATS server&quot;</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    (.writeBytes writer <span class="st">&quot;CONNECT {}</span><span class="sc">\r\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    (.<span class="kw">flush</span> writer)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">assert</span> (<span class="kw">=</span> (.readLine reader) <span class="st">&quot;+OK&quot;</span>))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    (.readLine reader)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">finally</span> (cleanup))))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">;; =&gt; &quot;PING&quot;</span></span></code></pre></div>
<p>Fantastic! Interactive programming sure is a great way to provide a
daily dose of dopamine.</p>
<p>Now things get a bit tricky. We want to wait a total of 3 seconds,
and print all the readLines we got. Why is that tricky?</p>
<p><em>We don’t know in advance how many readLines we need to
make</em>.</p>
<p>🤔</p>
<p>Reading the BufferedReader docs, we find the <a
href="https://docs.oracle.com/javase/8/docs/api/java/io/BufferedReader.html#ready--">.ready</a>
method. Awesome!</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">import</span> &#39;(java.io DataOutputStream InputStreamReader BufferedReader)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>        &#39;(java.net Socket))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [socket (Socket. <span class="st">&quot;demo.nats.io&quot;</span> <span class="dv">4222</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      reader (BufferedReader. (InputStreamReader. (.getInputStream socket)))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      writer (DataOutputStream. (.getOutputStream socket))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      cleanup #(<span class="kw">do</span> (.close reader)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                   (.close socket))]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">try</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">assert</span> (str/starts-with? (.readLine reader) <span class="st">&quot;INFO&quot;</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Expect INFO message from NATS server&quot;</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    (.writeBytes writer <span class="st">&quot;CONNECT {}</span><span class="sc">\r\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    (.<span class="kw">flush</span> writer)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">assert</span> (<span class="kw">=</span> (.readLine reader) <span class="st">&quot;+OK&quot;</span>))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    (Thread/sleep <span class="dv">3000</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">let</span> [lines (<span class="kw">atom</span> [])]</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">loop</span> []</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">if</span> (.ready reader)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">do</span> (<span class="kw">swap!</span> lines <span class="kw">conj</span> (.readLine reader))</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>              (<span class="kw">recur</span>))</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">@lines</span>)))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">finally</span> (cleanup))))</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">;; =&gt; [&quot;PING&quot;]</span></span></code></pre></div>
</body>
</html>
